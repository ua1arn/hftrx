#

reset_config srst_only srst_nogate
adapter srst pulse_width 100
adapter srst delay 100


proc wait_for_tap {} {
    set tries 0
    while { $tries < 20 } {
        if {[jtag arp_init]} {
            puts "TAP found"
            return 0
        }
        after 100
        incr tries
    }
    error "TAP did not appear"
}

if { [info exists CHIPNAME] } {
   set  _CHIPNAME $CHIPNAME
} else {
   set  _CHIPNAME t113s3
}

if { [info exists DAP_TAPID] } {
        set _DAP_TAPID $DAP_TAPID
} else {
        set _DAP_TAPID 0x5ba00477
}

jtag newtap $_CHIPNAME cpu -irlen 4 -expected-id $_DAP_TAPID
dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.cpu
target create $_CHIPNAME.ahb mem_ap -dap $_CHIPNAME.dap -ap-num 0
target create $_CHIPNAME.apb mem_ap -dap $_CHIPNAME.dap -ap-num 1


set _TARGETNAME0 $_CHIPNAME.cpu0
target create $_TARGETNAME0 cortex_a -dap $_CHIPNAME.dap -coreid 0 -rtos hwthread

set _TARGETNAME1 $_CHIPNAME.cpu1
target create $_TARGETNAME1 cortex_a -dap $_CHIPNAME.dap -coreid 1 -rtos hwthread
#$_CHIPNAME.cpu1 configure -defer-examine

targets $_TARGETNAME0
target smp $_TARGETNAME0 $_TARGETNAME1

init
targets

